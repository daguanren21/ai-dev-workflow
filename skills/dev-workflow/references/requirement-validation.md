# 需求符合性校验规范

> 在技术设计完成后、代码实现前，逐条校验设计方案是否完整覆盖产品需求。

---

## 校验时机

```
③ 技术设计 → ④ 技能匹配 → ⑤ 最佳实践 → 【⑥ 需求符合性校验】 → ⑦ 代码实现
```

校验通过后方可进入代码实现阶段。校验不通过则回退到技术设计阶段修正。

## 校验输入

| 输入 | 来源 |
|------|------|
| 原始需求 | `requirements.md` |
| 用户故事 + 验收标准 | `user-stories.md` |
| 技术设计方案 | `design.md` |
| 任务列表 | `tasks.md` |

## 校验流程

### Step 1: 构建需求追踪矩阵

逐条提取需求点，建立需求 → 用户故事 → 设计 → 任务的映射关系：

```markdown
| # | 需求点 | 用户故事 | 设计章节 | 实现任务 | 状态 |
|---|--------|---------|---------|---------|------|
| R1 | 用户可通过手机号登录 | US-1 | 3.1 认证模块 | Task-1, Task-2 | ✅ 覆盖 |
| R2 | 登录失败锁定账户 | US-2 | 3.1 认证模块 | Task-3 | ✅ 覆盖 |
| R3 | 支持第三方 OAuth | — | — | — | ❌ 未覆盖 |
```

### Step 2: 逐项校验

对每个需求点检查以下 5 项：

| 校验项 | 说明 | 判定标准 |
|--------|------|---------|
| **故事覆盖** | 需求点是否有对应的用户故事 | 每个需求点至少映射到 1 个 US |
| **验收标准完整** | 用户故事的 AC 是否可验证 | AC 使用 Given/When/Then，无模糊描述 |
| **设计落地** | 设计方案是否包含该需求的技术实现 | design.md 中有对应章节或说明 |
| **任务分解** | 是否有具体的实现任务 | tasks.md 中有对应的 task 条目 |
| **边界覆盖** | 异常流、边界条件是否考虑 | AC 中包含异常场景或设计中有错误处理说明 |

### Step 3: 输出校验报告

生成 `validation-report.md`，保存到 `docs/plans/{feature-name}/` 目录：

```markdown
# 需求符合性校验报告

## 基本信息
- 需求来源: [ONES/Jira/GitHub] #[ID]
- 校验时间: [timestamp]
- 校验结果: ✅ 通过 / ❌ 不通过

## 追踪矩阵
| # | 需求点 | US | 设计 | 任务 | 状态 |
|---|--------|----|------|------|------|
| R1 | ... | US-1 | §3.1 | T-1 | ✅ |

## 覆盖统计
- 需求总数: N
- 已覆盖: X (X/N)
- 未覆盖: Y
- 部分覆盖: Z

## 未覆盖项
| # | 需求点 | 缺失环节 | 建议处理方式 |
|---|--------|---------|------------|
| R3 | 支持第三方 OAuth | 无用户故事、无设计 | 补充 US 和设计，或与产品确认是否本期实现 |

## 风险项
| # | 需求点 | 风险描述 | 建议 |
|---|--------|---------|------|
| R2 | 登录失败锁定 | AC 未定义锁定阈值和解锁方式 | 与产品确认具体规则 |

## 结论
[通过/不通过，及后续行动]
```

## 校验判定规则

| 结果 | 条件 | 后续动作 |
|------|------|---------|
| ✅ 通过 | 所有需求点均已覆盖，无高风险项 | 进入 ⑦ 代码实现 |
| ⚠️ 有条件通过 | 覆盖率 ≥ 90%，未覆盖项为低优先级且已标记 | 与开发者确认后进入实现，未覆盖项记入 backlog |
| ❌ 不通过 | 存在未覆盖的核心需求，或高风险项未解决 | 回退到 ③ 技术设计，补充后重新校验 |

## 暂停点

校验完成后 **必须暂停**，将校验报告呈现给开发者：

- 如果通过：展示摘要，确认后继续
- 如果不通过：展示未覆盖项和风险项，等待开发者决策（补充设计 / 与产品沟通 / 标记为后续迭代）

## 常见遗漏模式

以下是容易被忽略的需求类型，校验时需特别关注：

| 类型 | 示例 |
|------|------|
| 权限控制 | "仅管理员可操作" — 是否有权限校验设计 |
| 数据校验 | "手机号格式校验" — 前后端是否都有校验 |
| 并发/竞态 | "库存扣减" — 是否考虑并发安全 |
| 性能要求 | "列表页 1s 内加载" — 是否有分页/缓存设计 |
| 兼容性 | "支持 IE11" — 是否影响技术选型 |
| 国际化 | "支持中英文" — 是否有 i18n 方案 |
| 无障碍 | "键盘可操作" — 是否有 a11y 设计 |
